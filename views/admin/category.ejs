<%- include('../layouts/header.ejs') %>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            min-height: 100vh;
        }

        table {
            width: 80%;
            max-width: 800px;
            margin: 20px auto;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background-color: #00d3a9;
            color: white;
        }

        .category-form {

            box-shadow: 4px 5px 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 40%;
            margin: 20px auto;
        }

        .category-form label {
            display: block;
            margin-bottom: 8px;
        }

        .category-form input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        .category-form button {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
        }

        /* .category-form button:hover {
            background-color: #45a049;
        } */

        .delete-button {
            padding: 8px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        #edit-button {
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        .delete-button {
            /* background-color: rgb(226, 15, 15); */
            color: white;
            margin-left: 10px;
        }

        /* .delete-button:hover {
        background-color: rgb(153, 14, 14);
    } */

        #edit-button {
            background-color: rgb(171, 146, 20);
            color: white;
            margin-left: 10px;
            text-decoration: none;
            padding-left: 10px;
            padding-right: 10px;

        }

        #edit-button:hover {
            background-color: #b1b404;
        }

        /* #btn1:hover {
            background-color: #3b4e3f;
        } */
        .btn-red {
    background-color: red;
    color: white; /* You may adjust the text color to make it visible on the red background */
  }

  .btn-green {
    background-color: green;
    color: white; /* You may adjust the text color to make it visible on the green background */
  }
  .btn-green:hover {
    background-color: rgb(102, 193, 11);
  }
  .btn-red:hover {
    background-color: brown;
  }
    </style>


    <!--  Body Wrapper -->
    <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
        data-sidebar-position="fixed" data-header-position="fixed">
        <!-- Sidebar Start -->
        <aside class="left-sidebar">
            <!-- Sidebar scroll-->
            <div>
                <div class="brand-logo d-flex align-items-center justify-content-between">
                    <a href="./index.html" class="text-nowrap logo-img">
                        <img src="../assets/images/logos/ShoeOne-Logo.png" width="180" alt="" />
                    </a>
                    <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
                        <i class="ti ti-x fs-8"></i>
                    </div>
                </div>
                <!-- Sidebar navigation-->
                <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
                    <ul id="sidebarnav">
                        <li class="nav-small-cap">
                            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                            <span class="hide-menu">Home</span>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="/admin/dashboard" aria-expanded="false">
                                <span>
                                    <i class="ti ti-layout-dashboard"></i>
                                </span>
                                <span class="hide-menu">Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link " href="/admin/customersList" aria-expanded="false">
                                <span>
                                    <i class="ti ti-user-plus"></i>
                                </span>
                                <span class="hide-menu">Customers</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link active" href="/admin/category" aria-expanded="false">
                                <span>
                                    <i class="ti ti-article"></i>
                                </span>
                                <span class="hide-menu">Categories</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="/admin/product" aria-expanded="false">
                                <span>
                                    <i class="fa-solid fa-layer-group"></i>
                                </span>
                                <span class="hide-menu">Products</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="/admin/user-Orders" aria-expanded="false">

                                <span>
                                    <i class="ti ti-file-description"></i>
                                </span>
                                <span class="hide-menu">Orders</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./ui-typography.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-cards"></i>
                                </span>
                                <span class="hide-menu">Payments</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="/admin/logout" aria-expanded="false">
                                <span>
                                    <i class="ti ti-login"></i>
                                </span>
                                <span class="hide-menu">Logout</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!-- End Sidebar navigation -->
            </div>
            <!-- End Sidebar scroll-->
        </aside>
        <!--  Sidebar End -->
        <!--  Main wrapper -->
        <div class="body-wrapper">
            <!--  Header Start -->
            <header class="app-header">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <ul class="navbar-nav">
                        <li class="nav-item d-block d-xl-none">
                            <a class="nav-link sidebartoggler nav-icon-hover" id="headerCollapse"
                                href="javascript:void(0)">
                                <i class="ti ti-menu-2"></i>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-icon-hover" href="javascript:void(0)">
                                <i class="ti ti-bell-ringing"></i>
                                <div class="notification bg-primary rounded-circle"></div>
                            </a>
                        </li>
                    </ul>
                    <div class="navbar-collapse justify-content-end px-0" id="navbarNav">
                        <ul class="navbar-nav flex-row ms-auto align-items-center justify-content-end">
                            <a href="https://adminmart.com/product/modernize-free-bootstrap-admin-dashboard/"
                                target="_blank" class="btn btn-primary">Profile</a>
                            <li class="nav-item dropdown">
                                <a class="nav-link nav-icon-hover" href="javascript:void(0)" id="drop2"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    <img src="../assets/images/profile/user-1.jpg" alt="" width="35" height="35"
                                        class="rounded-circle">
                                </a>
                                <div class="dropdown-menu dropdown-menu-end dropdown-menu-animate-up"
                                    aria-labelledby="drop2">
                                    <div class="message-body">
                                        <a href="javascript:void(0)"
                                            class="d-flex align-items-center gap-2 dropdown-item">
                                            <i class="ti ti-user fs-6"></i>
                                            <p class="mb-0 fs-3">My Profile</p>
                                        </a>
                                        <a href="javascript:void(0)"
                                            class="d-flex align-items-center gap-2 dropdown-item">
                                            <i class="ti ti-mail fs-6"></i>
                                            <p class="mb-0 fs-3">My Account</p>
                                        </a>
                                        <a href="javascript:void(0)"
                                            class="d-flex align-items-center gap-2 dropdown-item">
                                            <i class="ti ti-list-check fs-6"></i>
                                            <p class="mb-0 fs-3">My Task</p>
                                        </a>
                                        <a href="./authentication-login.html"
                                            class="btn btn-outline-primary mx-3 mt-2 d-block">Logout</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
            </header>
            <!-- //User Details Page -->
            <!-- <div class="container-fluid"> -->


            <div>
                <h1 style="font-weight: 700; margin-left: 50px;">Category</h1>
            </div>
<!-- display error message -->
         


            <div class="category-form">
                
                <h2>Add New Category</h2>
                <form id="addCategoryForm">
                    <label for="categoryname">Category Name:</label>
                    <input type="text" id="categoryname" name="categoryName" required>
                    <div id="error-message" style="color: red;"></div>
                    <button type="submit" id="btn1" onclick="return confirm('Are you want to add the category')">Add Category</button>
                </form>
                
            </div>
            <br>
           
            <table>
                <thead>
                    <tr>
                        <th class="text-center">Categories Name</th>
                        <th class="text-center">List</th>
                        <th class="text-center">Edit</th>

                    </tr>
                </thead>
                <tbody class="category-list" id="body-tbody">

                    <% for (let i=0; i < category.length; i++) { %>
                        <tr>
                            <td class="text-center">
                                <%= category[i].categoryName %>
                            </td>
                            <td class="text-center">

                                <button type="button" class="btn list-button 
                                    <%= category[i].is_listed==true ?  'btn-red ' : 'btn-green'%>"
                                    data-catid="<%= category[i]._id %>"
                                    data-state="<%= category[i].is_listed ? 'Listed' : 'Unlisted' %>">
                                    <%= category[i].is_listed ? 'Unlist' : 'List' %>

                                </button>
                                </td>

                                <!-- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -->
                                <td class="text-center">
                                <a href="/admin/edit-adcategory?id=<%= category[i]._id %>" class="btn"
                                    id="edit-button">Edit</a>
                            </td>
                        </tr>
                        <% } %>
                </tbody>
            </table>




            <!-- 
            </div> -->
        </div>
    </div>



    <script>
        document.getElementById('addCategoryForm').addEventListener('submit', async function (event) {
            event.preventDefault(); // Prevent the default form submission

            const categoryName = document.getElementById('categoryname').value.trim();

            // Check if the category is not empty and not already in the list
            if (categoryName !== '' && !categoryExists(categoryName)) {
                try {
                    const response = await fetch('/admin/add-category', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ categoryName }),
                    });

                    const data = await response.json();

                    if (data) {
                        // Create a new table row for the added category
                        const tbody = document.querySelector('#body-tbody')
                        const newtr = document.createElement('tr');
                        newtr.innerHTML = `<td class="text-center">${categoryName}</td>
                                <td class="text-center">
                                    <button type="button" class="btn list-button 
                                ${data.category.is_listed ?  'btn-red ' : 'btn-green'}"
                                        data-catid="${data.category._id}"
                                        data-state="${data.category.is_listed ? 'Listed' : 'Unlisted'}">
                                        ${data.category.is_listed ? 'Unlist' : 'List'}
                                    </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <a href="/admin/edit-adcategory?id=${data.category._id}" class="btn" id="edit-button">Edit</a>
                                </td>`;
                        tbody.appendChild(newtr);

                        // Clear the input field
                        document.getElementById('categoryname').value = '';

                        // Reload the page
                        location.reload();

                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            } else {
                // Display error message
                document.getElementById('error-message').innerText = 'Category must be non-empty and not already in the list and does not accept special letters only';
            }
        });

        // Function to check if the category already exists in the list (case-insensitive)
        function categoryExists(newCategory) {
            var existingCategories = document.querySelectorAll('.category-list td.text-center');
            var regex = new RegExp('^' + newCategory.replace(/[.*+?^${}()|[\]\\]/g, "\\$&") + '$', 'i');
            for (var i = 0; i < existingCategories.length; i++) {
                if (regex.test(existingCategories[i].innerText)) {
                    return true; // Category already exists
                }
            }
            return false; // Category does not exist
        }



        // document.getElementById('addCategoryForm').addEventListener('submit', async function (event) {
        //     event.preventDefault(); // Prevent the default form submission

        //     const categoryName = document.getElementById('categoryname').value;

        //     try {
        //         const response = await fetch('/admin/add-category', {
        //             method: 'POST',
        //             headers: {
        //                 'Content-Type': 'application/json',
        //             },
        //             body: JSON.stringify({ categoryName }),
        //         });

        //         const data = await response.json();

        //         if (data) {
        //             // Create a new table row for the added category
        //             const tbody = document.querySelector('#body-tbody')
        //             const newtr = document.createElement('tr');
        //             newtr.innerHTML = `<td class="text-center"> 
        //                             ${categoryName}
        //                         </td>
        //                         <td class="text-center">
        //                             <button type="button" class="btn list-button 
        //                         ${data.category.is_listed ? 'btn-danger' : 'btn-success'}"
        //                                 data-catid="${data.category._id}"
        //                                 data-state="${data.category.is_listed ? 'Listed' : 'Unlisted'}">
        //                                 ${data.category.is_listed ? 'Unlist' : 'List'}
        //                             </button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        //                             <a href="/admin/edit-adcategory?id=${data.category._id}" class="btn" id="edit-button">Edit</a>
        //                         </td>`
        //             tbody.appendChild(newtr)
        //             location.reload()
        //             document.getElementById('categoryname').value = '';
                   

        //         }
        //         Swal.fire({
        //                         position: "center",
        //                         icon: "success",
        //                         title: "Added the category",
        //                         showConfirmButton: false,
        //                         timer: 1500
        //                     });
        //     } catch (error) {
        //         console.error('Error:', error);
        //     }
        // });




        // list and unlist

        document.querySelectorAll('.list-button').forEach((button) => {
            button.addEventListener('click', () => {
                let catID = button.getAttribute('data-catID');
                console.log(catID);
                let currentState = button.getAttribute('data-state');
                console.log(currentState);
                let url;

                if (currentState == 'Unlisted') {
                    url = `/admin/list-cat/${catID}`;
                } else {
                    url = `/admin/Unlist-cat/${catID}`;
                }

                fetch(url, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(response => {
                    return response.json();
                }).then(data => {
                    if (data.message) {
                        console.log("hellooo");
                        if (currentState == 'Unlisted') {
                            button.setAttribute('data-state', 'listed');
                            button.textContent = 'Unlist';
                            button.classList.replace('btn-green', 'btn-red');
                            Swal.fire({
                                position: "center",
                                icon: "success",
                                title: "Listed the category",
                                showConfirmButton: false,
                                timer: 1500
                            });
                        } else {
                            button.setAttribute('data-state', 'Unlisted');
                            button.textContent = 'List';
                            button.classList.replace('btn-red', 'btn-green');
                            Swal.fire({
                                position: "center",
                                icon: "info",
                                title: "Unlisted the category",
                                showConfirmButton: false,
                                timer: 1500
                            });
                        }
                    }
                }).catch(error => {
                    console.log(error);
                });
            });
        });
    </script>





    <%- include('../layouts/footer.ejs') %>