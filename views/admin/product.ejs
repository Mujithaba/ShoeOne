<%- include('../layouts/header.ejs') %>

    <style>
        /* body {
            padding: 0px;
        } */

        .table img {
            max-width: 100px;
            max-height: 100px;
        }

        .action-buttons {
            white-space: nowrap;

        }

        .btn-red {
    background-color: red;
    color: white; /* You may adjust the text color to make it visible on the red background */
  }

  .btn-green {
    background-color: green;
    color: white; /* You may adjust the text color to make it visible on the green background */
  }
  .btn-green:hover {
    background-color: rgb(102, 193, 11);
  }
  .btn-red:hover {
    background-color: brown;
  }
    </style>

    <!--  Body Wrapper -->
    <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
        data-sidebar-position="fixed" data-header-position="fixed">
        <!-- Sidebar Start -->
        <aside class="left-sidebar">
            <!-- Sidebar scroll-->
            <div>
                <div class="brand-logo d-flex align-items-center justify-content-between">
                    <a href="./index.html" class="text-nowrap logo-img">
                        <img src="../assets/images/logos/ShoeOne-Logo.png" width="180" alt="" />
                    </a>
                    <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
                        <i class="ti ti-x fs-8"></i>
                    </div>
                </div>
                <!-- Sidebar navigation-->
                <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
                    <ul id="sidebarnav">
                        <li class="nav-small-cap">
                            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
                            <span class="hide-menu">Home</span>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="/admin/dashboard" aria-expanded="false">
                                <span>
                                    <i class="ti ti-layout-dashboard"></i>
                                </span>
                                <span class="hide-menu">Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link " href="/admin/customersList" aria-expanded="false">
                                <span>
                                    <i class="ti ti-user-plus"></i>
                                </span>
                                <span class="hide-menu">Customers</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link " href="/admin/category" aria-expanded="false">
                                <span>
                                    <i class="ti ti-article"></i>
                                </span>
                                <span class="hide-menu">Categories</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link active" href="/admin/product" aria-expanded="false">
                                <span>
                                    <i class="fa-solid fa-layer-group"></i>
                                </span>
                                <span class="hide-menu">Products</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="/admin/user-Orders" aria-expanded="false">

                                <span>
                                    <i class="ti ti-file-description"></i>
                                </span>
                                <span class="hide-menu">Orders</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="./ui-typography.html" aria-expanded="false">
                                <span>
                                    <i class="ti ti-cards"></i>
                                </span>
                                <span class="hide-menu">Payments</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" href="/admin/logout" aria-expanded="false">
                                <span>
                                    <i class="ti ti-login"></i>
                                </span>
                                <span class="hide-menu">Logout</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!-- End Sidebar navigation -->
            </div>
            <!-- End Sidebar scroll-->
        </aside>
        <!--  Sidebar End -->
        <!--  Main wrapper -->
        <div class="body-wrapper">
            <!--  Header Start -->
            <header class="app-header">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <ul class="navbar-nav">
                        <li class="nav-item d-block d-xl-none">
                            <a class="nav-link sidebartoggler nav-icon-hover" id="headerCollapse"
                                href="javascript:void(0)">
                                <i class="ti ti-menu-2"></i>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-icon-hover" href="javascript:void(0)">
                                <i class="ti ti-bell-ringing"></i>
                                <div class="notification bg-primary rounded-circle"></div>
                            </a>
                        </li>
                    </ul>
                    <div class="navbar-collapse justify-content-end px-0" id="navbarNav">
                        <ul class="navbar-nav flex-row ms-auto align-items-center justify-content-end">
                            <a href="https://adminmart.com/product/modernize-free-bootstrap-admin-dashboard/"
                                target="_blank" class="btn btn-primary">Profile</a>
                            <li class="nav-item dropdown">
                                <a class="nav-link nav-icon-hover" href="javascript:void(0)" id="drop2"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    <img src="../assets/images/profile/user-1.jpg" alt="" width="35" height="35"
                                        class="rounded-circle">
                                </a>
                                <div class="dropdown-menu dropdown-menu-end dropdown-menu-animate-up"
                                    aria-labelledby="drop2">
                                    <div class="message-body">
                                        <a href="javascript:void(0)"
                                            class="d-flex align-items-center gap-2 dropdown-item">
                                            <i class="ti ti-user fs-6"></i>
                                            <p class="mb-0 fs-3">My Profile</p>
                                        </a>
                                        <a href="javascript:void(0)"
                                            class="d-flex align-items-center gap-2 dropdown-item">
                                            <i class="ti ti-mail fs-6"></i>
                                            <p class="mb-0 fs-3">My Account</p>
                                        </a>
                                        <a href="javascript:void(0)"
                                            class="d-flex align-items-center gap-2 dropdown-item">
                                            <i class="ti ti-list-check fs-6"></i>
                                            <p class="mb-0 fs-3">My Task</p>
                                        </a>
                                        <a href="./authentication-login.html"
                                            class="btn btn-outline-primary mx-3 mt-2 d-block">Logout</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
            </header>
            <!-- //User Details Page -->
            <div class="container-fluid">

                <div class="container">

                    <% if(typeof message !=='undefined' ) { %>
                        <div class="alert alert-warning text-center mb-4">
                            <%= message %>
                        </div>
                        <% } %>

                            <h1 class="mt-4 mb-4">Product Management</h1>

                            <!-- Add New Product Button -->
                            <a type="button" class="btn btn-primary mb-2" data-toggle="modal"
                                data-target="#addProductModal" href="/admin/add-product">
                                Add New Product
                            </a>
                            <br><br>
                            <!-- Search Bar -->
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" placeholder="Product Name, Category..." id="searchInput"
                                    aria-label="Search" aria-describedby="basic-addon2">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="searchButton">Search</button>
                                </div>
                            </div>
                            

                            <!-- Product Table -->
                            <input type="hidden" value="<%= fullProduct %>" name="Product">
                            <table class="table table-bordered" id="productTable">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Image</th>
                                        <th>Product Name</th>
                                        <th>Price</th>
                                        <th>Size</th>
                                        <th>Description</th>
                                        <th>Stock</th>
                                        <th>Category</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% for(let i=0; i < fullProduct.length; i++) { %>
                                        <tr>
                                            <td>
                                                <%= i + 1 %>
                                            </td>

                                            <td>

                                                <% for(let j=0; j < fullProduct[i].image.length; j++) { %>
                                                    <img src="/Image/<%= fullProduct[i].image[j]  %>"
                                                        alt="Product Image <%= j + 1 %>" width="40px" height="40px">
                                                    <% } %>
                                            </td>

                                            <td>
                                                <%= fullProduct[i].productName %>
                                            </td>
                                            <td>
                                                <%= fullProduct[i].Price %>
                                            </td>
                                            <td>
                                                <%= fullProduct[i].productSize %>
                                            </td>
                                            <td>
                                                <%= fullProduct[i].description %>
                                            </td>
                                            <td>
                                                <%= fullProduct[i].stock %>
                                            </td>
                                            <td>
                                                <%= fullProduct[i].category?.categoryName %>
                                            </td>

                                            <td class="action-buttons">
                                                <button id="btn2" type="button" class="btn list-button 
                                    <%= fullProduct[i].is_listed==true ? 'btn-red ' : 'btn-green'%>"
                                                    data-catid="<%= fullProduct[i]._id %>"
                                                    data-state="<%= fullProduct[i].is_listed ? 'Listed' : 'Unlisted' %>">
                                                    <%= fullProduct[i].is_listed ? 'Unlist' : 'List' %>

                                                </button>


                                                <a href="/admin/edit-product?id= <%= fullProduct[i]._id %>"
                                                    class="btn btn-warning">Edit</a>
                                            </td>
                                        </tr>
                                        <% } %>
                                </tbody>
                            </table>
                </div>



            </div>
        </div>
    </div>


    <!-- product List and unlist -->
    <script>

        document.querySelectorAll('.list-button').forEach((button) => {
            button.addEventListener('click', () => {
                let prodID = button.getAttribute('data-catid');
                // console.log(prodID);
                let currentState = button.getAttribute('data-state');
                console.log(currentState);
                let url;

                if (currentState == 'Unlisted') {
                    url = `/admin/list-product/${prodID}`;
                } else {
                    url = `/admin/Unlist-product/${prodID}`;
                }

                fetch(url, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(response => {
                    return response.json();
                }).then(data => {
                    if (data.message) {
                        // console.log("hellooo");
                        if (currentState == 'Unlisted') {
                            button.setAttribute('data-state', 'listed');
                            button.textContent = 'Unlist';
                            button.classList.replace('btn-green', 'btn-red');
                            Swal.fire({
                                position: "center",
                                icon: "success",
                                title: "Listed the products",
                                showConfirmButton: false,
                                timer: 1500
                            });
                        } else {
                            button.setAttribute('data-state', 'Unlisted');
                            button.textContent = 'List';
                            button.classList.replace('btn-red', 'btn-green');
                            Swal.fire({
                                position: "center",
                                icon: "info",
                                title: "Unlisted the products",
                                showConfirmButton: false,
                                timer: 1500
                            });
                        }
                    }
                }).catch(error => {
                    console.log(error);
                });
            });
        });

    </script>




    <!-- search -->
    <script>
    document.getElementById('searchButton').addEventListener('click', () => {
    let searchInput = document.getElementById('searchInput').value.toLowerCase();
    let rows = document.querySelectorAll('#productTable tbody tr');

    rows.forEach(row => {
        let productName = row.querySelector('td:nth-child(3)').innerText.toLowerCase(); // Assuming product name is in the third column
        let category = row.querySelector('td:nth-child(8)').innerText.toLowerCase(); // Assuming category is in the eighth column

        let searchData = `${productName} ${category}`;
        
        if (searchData.includes(searchInput)) {
            row.style.display = ''; // Display the row if it matches the search criteria
        } else {
            row.style.display = 'none'; // Hide the row if it doesn't match
        }
    });
});

    </script>

    <%- include('../layouts/footer.ejs') %>